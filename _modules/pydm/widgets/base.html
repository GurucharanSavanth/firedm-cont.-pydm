

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pydm.widgets.base &mdash; PyDM v1.10.3+21.gb0ce4ae1 documentation</title>
  

  
  <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../../" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../../../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../../index.html" class="icon icon-home" alt="Documentation Home"> PyDM
          

          
          </a>

          
            
            
              <div class="version">
                v1.10.3+21.gb0ce4ae1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../installation.html">Installation</a></li>
</ul>
<p class="caption"><span class="caption-text">Configuration</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../configuration.html">Configuration</a></li>
</ul>
<p class="caption"><span class="caption-text">Tutorials</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://slaclab.github.io/pydm-tutorial">Explore Tutorials</a></li>
</ul>
<p class="caption"><span class="caption-text">User &amp; API Documentation</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../stylesheets.html">Customizing the Look and Feel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widgets/index.html">Widgets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widgets/widget_rules/index.html">Widget Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../add_data_plugins.html">Including Data Plugins</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../application.html">Application</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../channel.html">Channel</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../utilities/index.html">Utilities</a></li>
</ul>
<p class="caption"><span class="caption-text">Developers Corner</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../development/development.html">Development Guidelines</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../widgets/widget_rules/customizing.html">Customizing Properties for Rules</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../development/resources.html">Recommended Resources</a></li>
</ul>
<p class="caption"><span class="caption-text">Links</span></p>
<ul>
<li class="toctree-l1"><a class="reference external" href="https://github.com/slaclab/pydm">PyDM GitHub</a></li>
<li class="toctree-l1"><a class="reference external" href="https://github.com/slaclab">SLAC-wide GitHub</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">PyDM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../../index.html">Module code</a> &raquo;</li>
        
      <li>pydm.widgets.base</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for pydm.widgets.base</h1><div class="highlight"><pre>
<span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">platform</span>
<span class="kn">import</span> <span class="nn">weakref</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">functools</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">qtpy.QtWidgets</span> <span class="kn">import</span> <span class="p">(</span><span class="n">QApplication</span><span class="p">,</span> <span class="n">QMenu</span><span class="p">,</span> <span class="n">QGraphicsOpacityEffect</span><span class="p">,</span>
                            <span class="n">QToolTip</span><span class="p">,</span> <span class="n">QWidget</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">qtpy.QtGui</span> <span class="kn">import</span> <span class="n">QCursor</span>
<span class="kn">from</span> <span class="nn">qtpy.QtCore</span> <span class="kn">import</span> <span class="n">Qt</span><span class="p">,</span> <span class="n">QEvent</span><span class="p">,</span> <span class="n">Signal</span><span class="p">,</span> <span class="n">Slot</span><span class="p">,</span> <span class="n">Property</span>
<span class="kn">from</span> <span class="nn">.channel</span> <span class="kn">import</span> <span class="n">PyDMChannel</span>
<span class="kn">from</span> <span class="nn">..</span> <span class="kn">import</span> <span class="n">data_plugins</span><span class="p">,</span> <span class="n">tools</span><span class="p">,</span> <span class="n">config</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">is_qt_designer</span><span class="p">,</span> <span class="n">remove_protocol</span>
<span class="kn">from</span> <span class="nn">..display</span> <span class="kn">import</span> <span class="n">Display</span>
<span class="kn">from</span> <span class="nn">.rules</span> <span class="kn">import</span> <span class="n">RulesDispatcher</span>

<span class="k">try</span><span class="p">:</span>
    <span class="kn">from</span> <span class="nn">json.decoder</span> <span class="kn">import</span> <span class="n">JSONDecodeError</span>
<span class="k">except</span> <span class="ne">ImportError</span><span class="p">:</span>
    <span class="n">JSONDecodeError</span> <span class="o">=</span> <span class="ne">ValueError</span>

<span class="n">logger</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">is_channel_valid</span><span class="p">(</span><span class="n">channel</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Verify if a channel string is valid.</span>
<span class="sd">    For now a valid channel is a channel in which:</span>
<span class="sd">    - It is not None</span>
<span class="sd">    - It is not an empty string</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    channel : str</span>
<span class="sd">        The channel value</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    valid : bool</span>
<span class="sd">        Returns True if the channel is valid, False otherwise.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">channel</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">channel</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span>


<span class="k">def</span> <span class="nf">only_if_channel_set</span><span class="p">(</span><span class="n">fcn</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Decorator to avoid executing a method if a channel is not valid or configured.&quot;&quot;&quot;</span>

    <span class="nd">@functools</span><span class="o">.</span><span class="n">wraps</span><span class="p">(</span><span class="n">fcn</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">wrapper</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">is_channel_valid</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">):</span>
            <span class="k">return</span> <span class="n">fcn</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span>

    <span class="k">return</span> <span class="n">wrapper</span>


<span class="k">def</span> <span class="nf">widget_destroyed</span><span class="p">(</span><span class="n">channels</span><span class="p">,</span> <span class="n">widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Callback invoked when the Widget is destroyed.</span>
<span class="sd">    This method is used to ensure that the channels are disconnected.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    channels : list</span>
<span class="sd">        A list of PyDMChannel objects that this widget uses.</span>
<span class="sd">    widget : weakref</span>
<span class="sd">        Weakref to the widget.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">chs</span> <span class="o">=</span> <span class="n">channels</span><span class="p">()</span>
    <span class="k">if</span> <span class="n">chs</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">chs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">ch</span><span class="p">:</span>
                <span class="n">ch</span><span class="o">.</span><span class="n">disconnect</span><span class="p">(</span><span class="n">destroying</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">RulesDispatcher</span><span class="p">()</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="n">widget</span><span class="p">)</span>


<span class="k">def</span> <span class="nf">refresh_style</span><span class="p">(</span><span class="n">widget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Method that traverse the widget tree starting at `widget` and refresh the</span>
<span class="sd">    style for this widget and its childs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    widget : QWidget</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">widgets</span> <span class="o">=</span> <span class="p">[</span><span class="n">widget</span><span class="p">]</span>

    <span class="k">try</span><span class="p">:</span>
        <span class="n">widgets</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">widget</span><span class="o">.</span><span class="n">findChildren</span><span class="p">(</span><span class="n">QWidget</span><span class="p">))</span>
    <span class="k">except</span><span class="p">:</span>
        <span class="c1"># If we fail it means that widget is probably destroyed</span>
        <span class="k">return</span>
    <span class="k">for</span> <span class="n">child_widget</span> <span class="ow">in</span> <span class="n">widgets</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">child_widget</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">unpolish</span><span class="p">(</span><span class="n">child_widget</span><span class="p">)</span>
            <span class="n">child_widget</span><span class="o">.</span><span class="n">style</span><span class="p">()</span><span class="o">.</span><span class="n">polish</span><span class="p">(</span><span class="n">child_widget</span><span class="p">)</span>
            <span class="n">child_widget</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
            <span class="c1"># Widget was probably destroyed</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Error while refreshing stylesheet. </span><span class="si">%s</span><span class="s1"> &#39;</span><span class="p">,</span> <span class="n">ex</span><span class="p">)</span>


<span class="k">class</span> <span class="nc">PyDMPrimitiveWidget</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Primitive class that determines that a given widget is a PyDMWidget.</span>
<span class="sd">    All Widget classes from PyDMWidget will be True for</span>
<span class="sd">    isinstance(obj, PyDMPrimitiveWidget)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DEFAULT_RULE_PROPERTY</span> <span class="o">=</span> <span class="s2">&quot;Visible&quot;</span>
    <span class="n">RULE_PROPERTIES</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s1">&#39;Enable&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;setEnabled&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
        <span class="s1">&#39;Visible&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;setVisible&#39;</span><span class="p">,</span> <span class="nb">bool</span><span class="p">],</span>
        <span class="s1">&#39;Opacity&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;set_opacity&#39;</span><span class="p">,</span> <span class="nb">float</span><span class="p">]</span>
    <span class="p">}</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">instance</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_opacity</span> <span class="o">=</span> <span class="mf">1.0</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_qt_designer</span><span class="p">():</span>
            <span class="c1"># We should  install the Event Filter only if we are running</span>
            <span class="c1"># and not at the Designer</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        EventFilter to redirect &quot;middle click&quot; to :meth:`.show_address_tooltip`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Override the eventFilter to capture all middle mouse button events,</span>
        <span class="c1"># and show a tooltip if needed.</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">MouseButtonPress</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">button</span><span class="p">()</span> <span class="o">==</span> <span class="n">Qt</span><span class="o">.</span><span class="n">MiddleButton</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">show_address_tooltip</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">True</span>
        <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">show_address_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Show the PyDMTooltip and copy address to clipboard</span>

<span class="sd">        This is intended to replicate the behavior of the &quot;middle click&quot; from</span>
<span class="sd">        EDM. If the QWidget does not have a valid PyDMChannel nothing will be</span>
<span class="sd">        displayed</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channels_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;channels&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">channels_method</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="n">channels</span> <span class="o">=</span> <span class="n">channels_method</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Widget has no channels to display tooltip&#39;</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">addrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">no_proto_addrs</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">ch</span> <span class="ow">in</span> <span class="n">channels</span><span class="p">:</span>
            <span class="n">addr</span> <span class="o">=</span> <span class="n">ch</span><span class="o">.</span><span class="n">address</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">addr</span><span class="p">:</span>
                <span class="k">continue</span>
            <span class="n">addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">addr</span><span class="p">)</span>
            <span class="n">no_proto_addrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">remove_protocol</span><span class="p">(</span><span class="n">addr</span><span class="p">))</span>

        <span class="n">tooltip</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">addrs</span><span class="p">)</span>
        <span class="n">clipboard_text</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">no_proto_addrs</span><span class="p">)</span>
        <span class="n">QToolTip</span><span class="o">.</span><span class="n">showText</span><span class="p">(</span><span class="n">event</span><span class="o">.</span><span class="n">globalPos</span><span class="p">(),</span> <span class="n">tooltip</span><span class="p">)</span>
        <span class="c1"># If the address has a protocol, strip it out before putting it on the</span>
        <span class="c1"># clipboard.</span>

        <span class="n">clipboard</span> <span class="o">=</span> <span class="n">QApplication</span><span class="o">.</span><span class="n">clipboard</span><span class="p">()</span>

        <span class="n">mode</span> <span class="o">=</span> <span class="n">clipboard</span><span class="o">.</span><span class="n">Clipboard</span>
        <span class="k">if</span> <span class="n">platform</span><span class="o">.</span><span class="n">system</span><span class="p">()</span> <span class="o">==</span> <span class="s1">&#39;Linux&#39;</span><span class="p">:</span>
            <span class="c1"># Mode Selection is only valid for X11.</span>
            <span class="n">mode</span> <span class="o">=</span> <span class="n">clipboard</span><span class="o">.</span><span class="n">Selection</span>

        <span class="n">clipboard</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="n">clipboard_text</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="n">mode</span><span class="p">)</span>
        <span class="n">event</span> <span class="o">=</span> <span class="n">QEvent</span><span class="p">(</span><span class="n">QEvent</span><span class="o">.</span><span class="n">Clipboard</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">sendEvent</span><span class="p">(</span><span class="n">clipboard</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Float value between 0 and 1 representing the opacity of the widget</span>
<span class="sd">        where 0 means transparent.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        opacity : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_opacity</span>

    <span class="k">def</span> <span class="nf">set_opacity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Float value between 0 and 1 representing the opacity of the widget</span>
<span class="sd">        where 0 means transparent.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        val : float</span>
<span class="sd">            The new value for the opacity</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">op</span> <span class="o">=</span> <span class="n">QGraphicsOpacityEffect</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">val</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">elif</span> <span class="n">val</span> <span class="o">&lt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">val</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_opacity</span> <span class="o">=</span> <span class="n">val</span>
        <span class="n">op</span><span class="o">.</span><span class="n">setOpacity</span><span class="p">(</span><span class="n">val</span><span class="p">)</span>  <span class="c1"># 0 to 1 will cause the fade effect to kick in</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setGraphicsEffect</span><span class="p">(</span><span class="n">op</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setAutoFillBackground</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>


    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">dict</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rule_evaluated</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">payload</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback called when a rule has a new value for a property.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        payload : dict</span>
<span class="sd">            Dictionary containing the rule name, the property to be set and the</span>
<span class="sd">            new value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">name</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;name&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">prop</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;property&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span>
        <span class="n">value</span> <span class="o">=</span> <span class="n">payload</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s1">&#39;value&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">prop</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s1">&#39;Error at Rule: </span><span class="si">%s</span><span class="s1">. </span><span class="si">%s</span><span class="s1"> is not part of this widget properties.&#39;</span><span class="p">,</span>
                         <span class="n">name</span><span class="p">,</span> <span class="n">prop</span><span class="p">)</span>
            <span class="k">return</span>

        <span class="n">method_name</span><span class="p">,</span> <span class="n">data_type</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span><span class="p">[</span><span class="n">prop</span><span class="p">]</span>
        <span class="n">method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">method_name</span><span class="p">)</span>
        <span class="n">method</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="n">designable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        JSON-formatted list of dictionaries, with rules for the widget.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span>

    <span class="nd">@rules</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">rules</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_rules</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        JSON-formatted list of dictionaries, with rules for the widget.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_rules : str</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_rules</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_rules</span> <span class="o">=</span> <span class="n">new_rules</span>
            <span class="n">RulesDispatcher</span><span class="p">()</span><span class="o">.</span><span class="n">unregister</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">rules_list</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">loads</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_rules</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">rules_list</span><span class="p">:</span>
                    <span class="n">RulesDispatcher</span><span class="p">()</span><span class="o">.</span><span class="n">register</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">rules_list</span><span class="p">)</span>
            <span class="k">except</span> <span class="n">JSONDecodeError</span> <span class="k">as</span> <span class="n">ex</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">exception</span><span class="p">(</span><span class="s1">&#39;Invalid format for Rules&#39;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">find_parent_display</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="n">widget</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">while</span> <span class="n">widget</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">widget</span><span class="p">,</span> <span class="n">Display</span><span class="p">):</span>
                <span class="k">return</span> <span class="n">widget</span>
            <span class="n">widget</span> <span class="o">=</span> <span class="n">widget</span><span class="o">.</span><span class="n">parent</span><span class="p">()</span>
        <span class="k">return</span> <span class="kc">None</span>


<span class="k">class</span> <span class="nc">TextFormatter</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="n">default_precision_from_pv</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_user_prec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">update_format_string</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Reconstruct the format string to be used when representing the</span>
<span class="sd">        output value.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        format_string : str</span>
<span class="sd">            The format string to be used including or not the precision</span>
<span class="sd">            and unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">)):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format_string</span> <span class="o">=</span> <span class="s2">&quot;{:.&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">precision</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;f}&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">!=</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">format_string</span> <span class="o">+=</span> <span class="s2">&quot; </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_unit</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">format_string</span>

    <span class="k">def</span> <span class="nf">precision_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_precision</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel has new precision value.</span>
<span class="sd">        This callback also triggers an update_format_string call so the</span>
<span class="sd">        new precision value is considered.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_precison : int or float</span>
<span class="sd">            The new precision value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionFromPV</span> <span class="ow">and</span> <span class="n">new_precision</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span> <span class="o">=</span> <span class="n">new_precision</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">precisionChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_prec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the precision of the Channel</span>
<span class="sd">        This slot sends the new precision value to the</span>
<span class="sd">        ```precision_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_prec : int or float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">precision_changed</span><span class="p">(</span><span class="n">new_prec</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The precision to be used when formatting the output of the PV</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        prec : int</span>
<span class="sd">            The current precision value</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionFromPV</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_user_prec</span>

    <span class="nd">@precision</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">precision</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_prec</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The precision to be used when formatting the output of the PV.</span>
<span class="sd">        This has no effect when ```precisionFromPV``` is True.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_prec : int</span>
<span class="sd">            The new precision value to use</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># Only allow one to change the property if not getting the precision</span>
        <span class="c1"># from the PV</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="n">new_prec</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_prec</span> <span class="o">!=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_prec</span><span class="p">)</span> <span class="ow">and</span> <span class="n">new_prec</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_user_prec</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">new_prec</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">is_qt_designer</span><span class="p">()</span> <span class="ow">or</span> <span class="n">config</span><span class="o">.</span><span class="n">DESIGNER_ONLINE</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">unitChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the unit of the Channel</span>
<span class="sd">        This slot sends the new unit string to the</span>
<span class="sd">        ```unit_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_unit : str</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">unit_changed</span><span class="p">(</span><span class="n">new_unit</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">unit_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_unit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel has new unit value.</span>
<span class="sd">        This callback also triggers an update_format_string call so the</span>
<span class="sd">        new unit value is considered if ```showUnits``` is set.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_unit : str</span>
<span class="sd">            The new unit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">!=</span> <span class="n">new_unit</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_unit</span> <span class="o">=</span> <span class="n">new_unit</span>
            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>


    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">showUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A choice whether or not to show the units given by the channel</span>

<span class="sd">        If set to True, the units given in the channel will be displayed</span>
<span class="sd">        with the value. If using an EPICS channel, this will automatically</span>
<span class="sd">        be linked to the EGU field of the PV.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        show_units : bool</span>
<span class="sd">            True means that the unit will be appended to the output value</span>
<span class="sd">            format string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span>

    <span class="nd">@showUnits</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">showUnits</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">show_units</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A choice whether or not to show the units given by the channel</span>

<span class="sd">        If set to True, the units given in the channel will be displayed</span>
<span class="sd">        with the value. If using an EPICS channel, this will automatically</span>
<span class="sd">        be linked to the EGU field of the PV.</span>

<span class="sd">        Paramters</span>
<span class="sd">        ---------</span>
<span class="sd">        show_units : bool</span>
<span class="sd">            True means that the unit will be appended to the output value</span>
<span class="sd">            format string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span> <span class="o">!=</span> <span class="n">show_units</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span> <span class="o">=</span> <span class="n">show_units</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_format_string</span><span class="p">()</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">precisionFromPV</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A choice whether or not to use the precision given by channel.</span>

<span class="sd">        If set to False, the value received will be displayed as is, with</span>
<span class="sd">        no modification to the number of displayed significant figures.</span>
<span class="sd">        However, if set to True, and the channel specifies a display</span>
<span class="sd">        precision, a float or integer channel value will be set to display</span>
<span class="sd">        the correct precision. When using an EPICS Channel, the precision</span>
<span class="sd">        value corresponds to the PV&#39;s PREC field.</span>

<span class="sd">        It is also important to note, that if the value of the channel</span>
<span class="sd">        is a String, the choice of True or False will have no affect on</span>
<span class="sd">        the display.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        precison_from_pv : bool</span>
<span class="sd">            True means that the widget will use the precision information</span>
<span class="sd">            from the Channel if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="bp">self</span><span class="o">.</span><span class="n">default_precision_from_pv</span><span class="p">)</span>

    <span class="nd">@precisionFromPV</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">precisionFromPV</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        A choice whether or not to use the precision given by channel.</span>

<span class="sd">        If set to False, the value received will be displayed as is, with</span>
<span class="sd">        no modification to the number of displayed significant figures.</span>
<span class="sd">        However, if set to True, and the channel specifies a display</span>
<span class="sd">        precision, a float or integer channel value will be set to</span>
<span class="sd">        display the correct precision. When using an EPICS Channel, the</span>
<span class="sd">        precision value corresponds to the PV&#39;s PREC field.</span>

<span class="sd">        It is also important to note, that if the value of the channel is</span>
<span class="sd">        a String, the choice of True or False will have no affect on the</span>
<span class="sd">        display.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : bool</span>
<span class="sd">            True means that the widget will use the precision information</span>
<span class="sd">            from the PV if available.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="ow">is</span> <span class="kc">None</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="o">!=</span> <span class="nb">bool</span><span class="p">(</span><span class="n">value</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_precision_from_pv</span> <span class="o">=</span> <span class="n">value</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">update_format_string</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel value is changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_val : str, int, float, bool or np.ndarray</span>
<span class="sd">            The new value from the channel. The type depends on the channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">TextFormatter</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update_format_string</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PyDMWidget</span><span class="p">(</span><span class="n">PyDMPrimitiveWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PyDM base class for Read-Only widgets.</span>
<span class="sd">    This class implements all the functions of connection, alarm</span>
<span class="sd">    handling and more.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    init_channel : str, optional</span>
<span class="sd">        The channel to be used by the widget.</span>

<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Alarm types</span>
    <span class="n">ALARM_NONE</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="n">ALARM_MINOR</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">ALARM_MAJOR</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">ALARM_INVALID</span> <span class="o">=</span> <span class="mi">3</span>
    <span class="n">ALARM_DISCONNECTED</span> <span class="o">=</span> <span class="mi">4</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PyDMWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">all</span><span class="p">([</span><span class="n">prop</span> <span class="ow">in</span> <span class="n">PyDMPrimitiveWidget</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span> <span class="k">for</span> <span class="n">prop</span> <span class="ow">in</span>
                    <span class="p">[</span><span class="s1">&#39;Position - X&#39;</span><span class="p">,</span> <span class="s1">&#39;Position - Y&#39;</span><span class="p">]]):</span>
            <span class="n">PyDMWidget</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span> <span class="o">=</span> <span class="n">PyDMPrimitiveWidget</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
            <span class="n">PyDMWidget</span><span class="o">.</span><span class="n">RULE_PROPERTIES</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
                <span class="p">{</span><span class="s1">&#39;Position - X&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;setX&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span>
                 <span class="s1">&#39;Position - Y&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;setY&#39;</span><span class="p">,</span> <span class="nb">int</span><span class="p">]})</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_show_units</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_content</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_border</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ALARM_NONE</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">_upper_ctrl_limit</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_lower_ctrl_limit</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">enum_strings</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channeltype</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">=</span> <span class="kc">None</span>

        <span class="c1"># If this label is inside a PyDMApplication (not Designer) start it in</span>
        <span class="c1"># the disconnected state.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setContextMenuPolicy</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">DefaultContextMenu</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">contextMenuEvent</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">open_context_menu</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channel</span> <span class="o">=</span> <span class="n">init_channel</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">is_qt_designer</span><span class="p">():</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alarmSeverityChanged</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALARM_DISCONNECTED</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_enable_state</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">destroyed</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span>
            <span class="n">functools</span><span class="o">.</span><span class="n">partial</span><span class="p">(</span><span class="n">widget_destroyed</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">,</span> <span class="n">weakref</span><span class="o">.</span><span class="n">ref</span><span class="p">(</span><span class="bp">self</span><span class="p">))</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">widget_ctx_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Fetch the Widget specific context menu which will be populated with additional tools by `assemble_tools_menu`.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        QMenu or None</span>
<span class="sd">            If the return of this method is None a new QMenu will be created by `assemble_tools_menu`.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">generate_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates the custom context menu, and populates it with any external</span>
<span class="sd">        tools that have been loaded.  PyDMWidget subclasses should override</span>
<span class="sd">        this method (after calling superclass implementation) to add the menu.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        QMenu</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">widget_ctx_menu</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">menu</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">menu</span> <span class="o">=</span> <span class="n">QMenu</span><span class="p">(</span><span class="n">parent</span><span class="o">=</span><span class="bp">self</span><span class="p">)</span>

        <span class="n">kwargs</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;channels&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels_for_tools</span><span class="p">(),</span> <span class="s1">&#39;sender&#39;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
        <span class="n">tools</span><span class="o">.</span><span class="n">assemble_tools_menu</span><span class="p">(</span><span class="n">menu</span><span class="p">,</span> <span class="n">widget_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">widget</span><span class="o">=</span><span class="bp">self</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">menu</span>

    <span class="k">def</span> <span class="nf">open_context_menu</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ev</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Handler for when the Default Context Menu is requested.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        ev : QEvent</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">menu</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">generate_context_menu</span><span class="p">()</span>
        <span class="n">action</span> <span class="o">=</span> <span class="n">menu</span><span class="o">.</span><span class="n">exec_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mapToGlobal</span><span class="p">(</span><span class="n">ev</span><span class="o">.</span><span class="n">pos</span><span class="p">()))</span>
        <span class="k">del</span> <span class="n">menu</span>

    <span class="k">def</span> <span class="nf">init_for_designer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called after the constructor to tweak configurations for</span>
<span class="sd">        when using the widget with the Qt Designer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">connection_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the connection state of the Channel is changed.</span>
<span class="sd">        This callback acts on the connection state to enable/disable the widget</span>
<span class="sd">        and also trigger the change on alarm severity to ALARM_DISCONNECTED.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        connected : int</span>
<span class="sd">            When this value is 0 the channel is disconnected, 1 otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span> <span class="o">=</span> <span class="n">connected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_enable_state</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">connected</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alarmSeverityChanged</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALARM_DISCONNECTED</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">alarmSeverityChanged</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ALARM_NONE</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel value is changed.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_val : str, int, float, bool or np.ndarray</span>
<span class="sd">            The new value from the channel. The type depends on the channel.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">new_val</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">channeltype</span> <span class="o">=</span> <span class="nb">type</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channeltype</span> <span class="o">==</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">subtype</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="o">.</span><span class="n">dtype</span><span class="o">.</span><span class="n">type</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">channeltype</span> <span class="o">==</span> <span class="n">unicode</span><span class="p">:</span>
                    <span class="c1"># For Python 2.7, set the the channel type to str instead of unicode</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">channeltype</span> <span class="o">=</span> <span class="nb">str</span>
            <span class="k">except</span> <span class="ne">NameError</span><span class="p">:</span>
                <span class="k">pass</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="n">designable</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">alarmSeverity</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span>

    <span class="nd">@alarmSeverity</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">alarmSeverity</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_severity</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span> <span class="o">!=</span> <span class="n">new_severity</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span> <span class="o">=</span> <span class="n">new_severity</span>

    <span class="k">def</span> <span class="nf">alarm_severity_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_alarm_severity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel alarm severity is changed.</span>
<span class="sd">        This callback is not processed if the widget has no channel</span>
<span class="sd">        associated with it.</span>
<span class="sd">        This callback handles the composition of the stylesheet to be</span>
<span class="sd">        applied and the call</span>
<span class="sd">        to update to redraw the widget with the needed changes for the</span>
<span class="sd">        new state.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_alarm_severity : int</span>
<span class="sd">            The new severity where 0 = NO_ALARM, 1 = MINOR, 2 = MAJOR</span>
<span class="sd">            and 3 = INVALID</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># 0 = NO_ALARM, 1 = MINOR, 2 = MAJOR, 3 = INVALID</span>
        <span class="k">if</span> <span class="n">new_alarm_severity</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span><span class="p">:</span>
            <span class="k">return</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span> <span class="o">=</span> <span class="n">PyDMWidget</span><span class="o">.</span><span class="n">ALARM_NONE</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span> <span class="o">=</span> <span class="n">new_alarm_severity</span>
        <span class="n">refresh_style</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">enum_strings_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_enum_strings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel has new enum values.</span>
<span class="sd">        This callback also triggers a value_changed call so the</span>
<span class="sd">        new enum values to be broadcasted</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_enum_strings : tuple</span>
<span class="sd">            The new list of values</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">new_enum_strings</span> <span class="o">!=</span> <span class="bp">self</span><span class="o">.</span><span class="n">enum_strings</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">enum_strings</span> <span class="o">=</span> <span class="n">new_enum_strings</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_address</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="p">):</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Object </span><span class="si">%r</span><span class="s2"> has no PyDM Channels&quot;</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span>
            <span class="k">return</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">address</span>

    <span class="k">def</span> <span class="nf">ctrl_limit_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">which</span><span class="p">,</span> <span class="n">new_limit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel receives new control limit</span>
<span class="sd">        values.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        which : str</span>
<span class="sd">            Which control limit was changed. &quot;UPPER&quot; or &quot;LOWER&quot;</span>
<span class="sd">        new_limit : float</span>
<span class="sd">            New value for the control limit</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">which</span> <span class="o">==</span> <span class="s2">&quot;UPPER&quot;</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_upper_ctrl_limit</span> <span class="o">=</span> <span class="n">new_limit</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_lower_ctrl_limit</span> <span class="o">=</span> <span class="n">new_limit</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">connectionStateChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">connected</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the Connection State of the Channel</span>
<span class="sd">        This slot sends the connection state to the ```connection_changed```</span>
<span class="sd">        callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        connected : bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># false = disconnected, true = connected</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">connection_changed</span><span class="p">(</span><span class="n">connected</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="nd">@Slot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">channelValueChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_val</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the Value of the Channel</span>
<span class="sd">        This slot sends the value to the ```value_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_val : int, float, str, bool or np.ndarray</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value_changed</span><span class="p">(</span><span class="n">new_val</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">alarmSeverityChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_alarm_severity</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the Alarm Severity of the Channel</span>
<span class="sd">        This slot sends the severity value to the</span>
<span class="sd">        ```alarm_severity_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_alarm_severity : int</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alarm_severity_changed</span><span class="p">(</span><span class="n">new_alarm_severity</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">tuple</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">enumStringsChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_enum_strings</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the string values of the Channel</span>
<span class="sd">        This slot sends the new strings to the</span>
<span class="sd">        ```enum_strings_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_enum_strings : tuple</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">enum_strings_changed</span><span class="p">(</span><span class="n">new_enum_strings</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">upperCtrlLimitChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_limit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the upper control limit value of the Channel</span>
<span class="sd">        This slot sends the new limit value to the</span>
<span class="sd">        ```ctrl_limit_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_limit : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_limit_changed</span><span class="p">(</span><span class="s2">&quot;UPPER&quot;</span><span class="p">,</span> <span class="n">new_limit</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">lowerCtrlLimitChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_limit</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the lower control limit value of the Channel</span>
<span class="sd">        This slot sends the new limit value to the</span>
<span class="sd">        ```ctrl_limit_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_limit : float</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ctrl_limit_changed</span><span class="p">(</span><span class="s2">&quot;LOWER&quot;</span><span class="p">,</span> <span class="n">new_limit</span><span class="p">)</span>

    <span class="nd">@Slot</span><span class="p">()</span>
    <span class="k">def</span> <span class="nf">force_redraw</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot to force a redraw on the widget.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">update</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">setX</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_x</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the X position of the Widget on the screen.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_x : int</span>
<span class="sd">            The new X position</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">point</span><span class="o">.</span><span class="n">setX</span><span class="p">(</span><span class="n">new_x</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setY</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_y</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Set the Y position of the Widget on the screen.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_y : int</span>
<span class="sd">            The new Y position</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">point</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos</span><span class="p">()</span>
        <span class="n">point</span><span class="o">.</span><span class="n">setY</span><span class="p">(</span><span class="n">new_y</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="n">point</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">alarmSensitiveContent</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not the content color changes when alarm severity</span>
<span class="sd">        changes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True means that the content color will be changed in case of</span>
<span class="sd">            alarm severity changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_content</span>

    <span class="nd">@alarmSensitiveContent</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">alarmSensitiveContent</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not the content color changes when alarm severity</span>
<span class="sd">        changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        checked : bool</span>
<span class="sd">            True means that the content color will be changed in case of</span>
<span class="sd">            alarm severity changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_content</span> <span class="o">=</span> <span class="n">checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alarm_severity_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">alarmSensitiveBorder</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not the border color changes when alarm severity changes.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True means that the border color will be changed in case of</span>
<span class="sd">            alarm severity changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_border</span>

    <span class="nd">@alarmSensitiveBorder</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">alarmSensitiveBorder</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">checked</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Whether or not the border color changes when alarm severity</span>
<span class="sd">        changes.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        checked : bool</span>
<span class="sd">            True means that the border color will be changed in case of</span>
<span class="sd">            alarm severity changes.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_alarm_sensitive_border</span> <span class="o">=</span> <span class="n">checked</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">alarm_severity_changed</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_alarm_state</span><span class="p">)</span>

    <span class="nd">@Property</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">channel</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The channel address in use for this widget.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        channel : str</span>
<span class="sd">            Channel address</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">)</span>
        <span class="k">return</span> <span class="kc">None</span>

    <span class="nd">@channel</span><span class="o">.</span><span class="n">setter</span>
    <span class="k">def</span> <span class="nf">channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        The channel address to use for this widget.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        value : str</span>
<span class="sd">            Channel address</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">!=</span> <span class="n">value</span><span class="p">:</span>
            <span class="c1"># Remove old connections</span>
            <span class="k">for</span> <span class="n">channel</span> <span class="ow">in</span> <span class="p">[</span><span class="n">c</span> <span class="k">for</span> <span class="n">c</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span> <span class="k">if</span>
                            <span class="n">c</span><span class="o">.</span><span class="n">address</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">]:</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">disconnect</span><span class="p">()</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>
            <span class="c1"># Load new channel</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">value</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">:</span>
                <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s1">&#39;Channel was set to an empty string.&#39;</span><span class="p">)</span>
                <span class="k">return</span>
            <span class="n">channel</span> <span class="o">=</span> <span class="n">PyDMChannel</span><span class="p">(</span><span class="n">address</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">_channel</span><span class="p">,</span>
                                  <span class="n">connection_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">connectionStateChanged</span><span class="p">,</span>
                                  <span class="n">value_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">channelValueChanged</span><span class="p">,</span>
                                  <span class="n">severity_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">alarmSeverityChanged</span><span class="p">,</span>
                                  <span class="n">enum_strings_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">enumStringsChanged</span><span class="p">,</span>
                                  <span class="n">unit_slot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">prec_slot</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">upper_ctrl_limit_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">upperCtrlLimitChanged</span><span class="p">,</span>
                                  <span class="n">lower_ctrl_limit_slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lowerCtrlLimitChanged</span><span class="p">,</span>
                                  <span class="n">value_signal</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
                                  <span class="n">write_access_slot</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
            <span class="c1"># Load writeable channels if our widget requires them. These should</span>
            <span class="c1"># not exist on the base PyDMWidget but prevents us from duplicating</span>
            <span class="c1"># the method below to only make two more connections</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;writeAccessChanged&#39;</span><span class="p">):</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">write_access_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">writeAccessChanged</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;send_value_signal&#39;</span><span class="p">):</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">value_signal</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">send_value_signal</span>
            <span class="c1"># Do the same thing for classes that use the TextFormatter mixin.</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;unitChanged&#39;</span><span class="p">):</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">unit_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">unitChanged</span>
            <span class="k">if</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;precisionChanged&#39;</span><span class="p">):</span>
                <span class="n">channel</span><span class="o">.</span><span class="n">prec_slot</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">precisionChanged</span>
            <span class="c1"># Connect write channels if we have them</span>
            <span class="n">channel</span><span class="o">.</span><span class="n">connect</span><span class="p">()</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">channel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">restore_original_tooltip</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">toolTip</span><span class="p">()</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_tooltip</span>

    <span class="nd">@only_if_channel_set</span>
    <span class="k">def</span> <span class="nf">check_enable_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether or not the widget should be disable.</span>
<span class="sd">        This method also disables the widget and add a Tool Tip</span>
<span class="sd">        with the reason why it is disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span>
        <span class="n">tooltip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_original_tooltip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tooltip</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">tooltip</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="s2">&quot;PV is disconnected.&quot;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_address</span><span class="p">()</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get_ctrl_limits</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a tuple with the control limits for the channel</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        (lower, upper) : tuple</span>
<span class="sd">            Lower and Upper control limits</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_lower_ctrl_limit</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">_upper_ctrl_limit</span>

    <span class="k">def</span> <span class="nf">channels</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the channels being used for this Widget.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        channels : list</span>
<span class="sd">            List of PyDMChannel objects</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_channels</span><span class="p">):</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_channels</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="nf">channels_for_tools</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a list of channels useful for external tools.</span>
<span class="sd">        The default implementation here is just to return</span>
<span class="sd">        self.channels(), but some widgets will want to re-implement</span>
<span class="sd">        this, especially if they have multiple channels, but only</span>
<span class="sd">        one real &#39;signal&#39; channel.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">channels</span><span class="p">()</span>


<span class="k">class</span> <span class="nc">PyDMWritableWidget</span><span class="p">(</span><span class="n">PyDMWidget</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    PyDM base class for Writable widgets.</span>
<span class="sd">    This class implements the send_value_signal and also the event filter for write access changes on PVs.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    init_channel : str, optional</span>
<span class="sd">        The channel to be used by the widget.</span>

<span class="sd">    Signals</span>
<span class="sd">    -------</span>
<span class="sd">    send_value_signal : int, float, str, bool or np.ndarray</span>
<span class="sd">        Emitted when the user changes the value</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">__Signals__</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;send_value_signal([int], [float], [str], [bool], [np.ndarray])&quot;</span><span class="p">)</span>

    <span class="c1"># Emitted when the user changes the value.</span>
    <span class="n">send_value_signal</span> <span class="o">=</span> <span class="n">Signal</span><span class="p">([</span><span class="nb">int</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">],</span> <span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="p">[</span><span class="nb">bool</span><span class="p">],</span> <span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">])</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">init_channel</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PyDMWritableWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">init_channel</span><span class="o">=</span><span class="n">init_channel</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">init_for_designer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Method called after the constructor to tweak configurations for</span>
<span class="sd">        when using the widget with the Qt Designer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">PyDMWritableWidget</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="n">init_for_designer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span> <span class="o">=</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Filters events on this object.</span>

<span class="sd">        Params</span>
<span class="sd">        ------</span>
<span class="sd">        object : QObject</span>
<span class="sd">            The object that is being handled.</span>
<span class="sd">        event : QEvent</span>
<span class="sd">            The event that is happening.</span>

<span class="sd">        Returns</span>
<span class="sd">        -------</span>
<span class="sd">        bool</span>
<span class="sd">            True to stop the event from being handled further; otherwise</span>
<span class="sd">            return false.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">channel</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s1">&#39;channel&#39;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">is_channel_valid</span><span class="p">(</span><span class="n">channel</span><span class="p">):</span>
            <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">Leave</span><span class="p">:</span>
                <span class="n">QApplication</span><span class="o">.</span><span class="n">restoreOverrideCursor</span><span class="p">()</span>

            <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">type</span><span class="p">()</span> <span class="o">==</span> <span class="n">QEvent</span><span class="o">.</span><span class="n">Enter</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">status</span><span class="p">:</span>
                <span class="n">QApplication</span><span class="o">.</span><span class="n">setOverrideCursor</span><span class="p">(</span><span class="n">QCursor</span><span class="p">(</span><span class="n">Qt</span><span class="o">.</span><span class="n">ForbiddenCursor</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">PyDMWidget</span><span class="o">.</span><span class="n">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">,</span> <span class="n">event</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">write_access_changed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">new_write_access</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Callback invoked when the Channel has new write access value.</span>
<span class="sd">        This callback calls check_enable_state so it can act on the widget</span>
<span class="sd">        enabling or disabling it accordingly</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        new_write_access : bool</span>
<span class="sd">            True if write operations to the channel are allowed.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span> <span class="o">=</span> <span class="n">new_write_access</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">check_enable_state</span><span class="p">()</span>

    <span class="nd">@Slot</span><span class="p">(</span><span class="nb">bool</span><span class="p">)</span>
    <span class="k">def</span> <span class="nf">writeAccessChanged</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">write_access</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        PyQT Slot for changes on the write access value of the Channel</span>
<span class="sd">        This slot sends the write access value to the ```write_access_changed``` callback.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">        write_access : bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">write_access_changed</span><span class="p">(</span><span class="n">write_access</span><span class="p">)</span>

    <span class="nd">@only_if_channel_set</span>
    <span class="k">def</span> <span class="nf">check_enable_state</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks whether or not the widget should be disable.</span>
<span class="sd">        This method also disables the widget and add a Tool Tip</span>
<span class="sd">        with the reason why it is disabled.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">status</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span>
        <span class="n">tooltip</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">restore_original_tooltip</span><span class="p">()</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_connected</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tooltip</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">tooltip</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="s2">&quot;PV is disconnected.&quot;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="n">tooltip</span> <span class="o">+=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_address</span><span class="p">()</span>
        <span class="k">elif</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">_write_access</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">tooltip</span> <span class="o">!=</span> <span class="s1">&#39;&#39;</span><span class="p">:</span>
                <span class="n">tooltip</span> <span class="o">+=</span> <span class="s1">&#39;</span><span class="se">\n</span><span class="s1">&#39;</span>
            <span class="k">if</span> <span class="n">data_plugins</span><span class="o">.</span><span class="n">is_read_only</span><span class="p">():</span>
                <span class="n">tooltip</span> <span class="o">+=</span> <span class="s2">&quot;Running PyDM on Read-Only mode.&quot;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">tooltip</span> <span class="o">+=</span> <span class="s2">&quot;Access denied by Channel Access Security.&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setToolTip</span><span class="p">(</span><span class="n">tooltip</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">setEnabled</span><span class="p">(</span><span class="n">status</span><span class="p">)</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright 2016, mgibbs, hhslepicka, trendahl, zlentz

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>